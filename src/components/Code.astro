---
import { Code } from "astro/components"

const { code, lang } = Astro.props
---
<script>
    function copyToClipboard(value) {
        const $textarea = document.createElement("textarea");
        $textarea.innerHTML = value;
        document.body.appendChild($textarea);
        $textarea.select();
        let success = false;
        try {
            document.execCommand("copy");
            success = true
        } catch (err) {
            alert(
            "Oops, unable to copy to clipboard. Please check website permissions."
            );
        }
        $textarea.remove();
        return success;
    }

    for(const $codeCopyContainer of document.querySelectorAll("[data-code-copy-container]")){
        const $codeCopyText = $codeCopyContainer.querySelector("[data-code-copy-text]")
        const $codeCopyButton = $codeCopyContainer.querySelector("[data-code-copy-button]")

        $codeCopyButton.addEventListener("click", () => {
            copyToClipboard($codeCopyText.innerText)
        })
    }
</script>

<div data-code-copy-container class="relative group">
    <div data-code-copy-text>
        <Code code={code} lang={lang} />
    </div>
    <div class="absolute hidden group-hover:block transition-all top-0 right-0 mt-2 mr-2">
        <button data-code-copy-button class="px-1.5 py-1 rounded border opacity-60 hover:opacity-90" title="Copy to clipboard">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        </button>
    </div>
</div>